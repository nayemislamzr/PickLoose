<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Learn IndexedDB</title>
</head>

<body>
    <input type="text" id="videoID" placeholder="videoID">
    <input type="text" id="information" placeholder="videoInformation">
    <select id="platform">
        <option>YouTubeVideos</option>
        <option>TwitchVideos</option>
        <option>FaceBookVideos</option>
    </select>
    <button id="submit">Submit</button>

    <script>
        const id = document.querySelector("input#videoID");
        const info = document.querySelector("input#information");
        const platform = document.querySelector("select#platform")
        const submitButton = document.querySelector("button#submit");

        function submit(id = "asdqwcdfaefaf", info = "This is a cool video", platform = "YouTubeVideos") {
            // console.log(email, name, birthdate);
            let db = window.indexedDB.open("video", 7);

            db.onupgradeneeded = e => {
                console.log(`upgrade needed for : ${e.oldVersion} -> (${e.newVersion})`);
                let dataBase = e.target.result;

                dataBase.createObjectStore("YouTubeVideos", {
                    keyPath: "id"
                });

                dataBase.createObjectStore("TwitchVideos", {
                    keyPath: "id"
                });

                dataBase.createObjectStore("FaceBookVideos", {
                    keyPath: "id"
                });

            }

            db.onsuccess = e => {
                let dataBase = e.target.result;
                console.log(`Successfully opened DataBase : ${dataBase.name}(${dataBase.version})`);

                let transaction = dataBase.transaction([platform], "readwrite");

                transaction.onerror = e => {
                    console.log(`error :  ${e.target.error}`);
                }

                // transaction.oncomplete = e => { // for inderting data
                //     console.log("Data Insertion : Successfull");
                // }

                transaction.oncomplete = e => { // for getting data
                    console.log(`The information about the videoID ${id} is :\n ` + JSON.stringify(request.result))
                }

                // transaction.oncomplete = e => { // for deleting data
                //     console.log("Data Deletion : Successfull");
                // }

                // transaction.oncomplete = e => {
                //     console.log("Data Update : Successfull");
                // }

                let objectStore = transaction.objectStore(platform);

                // adding data

                // console.log("adding data..")
                // objectStore.add({
                //     id: id,
                //     info: info
                // })

                //getting data 

                console.log("getting data...")
                let request = objectStore.get(id);

                //deleting data

                // console.log("deleting data");
                // let request = objectStore.delete(id);

                // updating data
                // console.log("updating data");
                // let request = objectStore.put({
                //     id: id + "new",
                //     info: info + "new"
                // })
            }

            db.onerror = e => {
                console.log(`error : ${e.errorCode}`);
            }
        }

        submitButton.addEventListener("click", () => {
            submit(id.value, info.value, platform.value)
        });
    </script>
</body>

</html>